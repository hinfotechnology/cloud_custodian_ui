{% extends 'manager/base.html' %}

{% block content %}
<div class="container-fluid">
    <h1 class="mt-4">AWS Service Details</h1>
    <p>The resources below are fetched from your AWS account.</p>

    {% if error %}
    <div class="alert alert-danger" role="alert">
        {{ error }}
    </div>
    {% endif %}

    {% if services %}
    <h2 class="mt-4">Resource Details</h2>
    <div class="accordion" id="servicesAccordion">
    {% for service_name, resources in services.items %}
    <div class="accordion-item">
        <h2 class="accordion-header" id="heading-{{ forloop.counter }}">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ forloop.counter }}" aria-expanded="false" aria-controls="collapse-{{ forloop.counter }}">
                {{ service_name }} ({{ resources|length }})
            </button>
        </h2>
        <div id="collapse-{{ forloop.counter }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ forloop.counter }}" data-bs-parent="#servicesAccordion">
            <div class="accordion-body">
                {% if resources %}
                <div class="table-responsive">
                    <table class="table table-striped table-bordered">
                        <thead class="table-dark">
                            <tr>
                                {% if service_name == 'EC2 Instances' %}
                                    <th>ID</th>
                                    <th>Status</th>
                                    <th>Region</th>
                                    <th>Creation Date</th>
                                {% elif service_name == 'S3 Buckets' %}
                                    <th>Name</th>
                                    <th>Region</th>
                                    <th>Status</th>
                                    <th>Creation Date</th>
                                {% elif service_name == 'RDS Instances' %}
                                    <th>ID</th>
                                    <th>Status</th>
                                    <th>Region</th>
                                    <th>Creation Date</th>
                                {% elif service_name == 'VPCs' %}
                                    <th>ID</th>
                                    <th>Is Default</th>
                                    <th>CIDR Block</th>
                                    <th>Region</th>
                                {% elif service_name == 'Subnets' %}
                                    <th>ID</th>
                                    <th>VPC ID</th>
                                    <th>CIDR Block</th>
                                    <th>Availability Zone</th>
                                    <th>Region</th>
                                {% elif service_name == 'Security Groups' %}
                                    <th>ID</th>
                                    <th>Name</th>
                                    <th>VPC ID</th>
                                    <th>Region</th>
                                {% endif %}
                            </tr>
                        </thead>
                        <tbody>
                            {% for resource in resources %}
                            <tr>
                                {% if service_name == 'EC2 Instances' %}
                                    <td>{{ resource.id }}</td>
                                    <td>{{ resource.status }}</td>
                                    <td>{{ resource.region }}</td>
                                    <td>{{ resource.creation_date|date:"Y-m-d H:i:s" }}</td>
                                {% elif service_name == 'S3 Buckets' %}
                                    <td>{{ resource.name }}</td>
                                    <td>{{ resource.region }}</td>
                                    <td>{{ resource.status }}</td>
                                    <td>{{ resource.creation_date|date:"Y-m-d H:i:s" }}</td>
                                {% elif service_name == 'RDS Instances' %}
                                    <td>{{ resource.id }}</td>
                                    <td>{{ resource.status }}</td>
                                    <td>{{ resource.region }}</td>
                                    <td>{{ resource.creation_date|date:"Y-m-d H:i:s" }}</td>
                                {% elif service_name == 'VPCs' %}
                                    <td>{{ resource.id }}</td>
                                    <td>{{ resource.is_default }}</td>
                                    <td>{{ resource.cidr_block }}</td>
                                    <td>{{ resource.region }}</td>
                                {% elif service_name == 'Subnets' %}
                                    <td>{{ resource.id }}</td>
                                    <td>{{ resource.vpc_id }}</td>
                                    <td>{{ resource.cidr_block }}</td>
                                    <td>{{ resource.availability_zone }}</td>
                                    <td>{{ resource.region }}</td>
                                {% elif service_name == 'Security Groups' %}
                                    <td>{{ resource.id }}</td>
                                    <td>{{ resource.name }}</td>
                                    <td>{{ resource.vpc_id }}</td>
                                    <td>{{ resource.region }}</td>
                                {% endif %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p>No resources found.</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>
{% endif %}

{% endblock %}
